<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BTCT Town</title>
  <link rel="stylesheet" href="town-style.css?v=20260222c">
</head>
<body>
  <!-- Top Bar -->
  <div id="top-bar">
    <div class="top-left">
      <a href="/" class="back-link">‚Üê DEX</a>
      <span class="town-title">BTCT Town</span>
    </div>
    <div class="top-center">
      <span id="wallet-display">No Wallet</span>
    </div>
    <div class="top-right">
      <span id="player-count">0 online</span>
    </div>
  </div>

  <!-- Game Container -->
  <div id="game-container"></div>

  <!-- Interaction Panel (appears when near NPC/player) -->
  <div id="interaction-panel" class="panel hidden">
    <div class="panel-header">
      <span id="panel-title">Bulletin Board</span>
      <button id="panel-close" onclick="closePanel()">‚úï</button>
    </div>
    <div id="panel-content"></div>
  </div>

  <!-- Trade Modal -->
  <div id="trade-modal" class="modal-overlay hidden">
    <div class="modal-box">
      <div class="modal-header">
        <span id="modal-title">Trade</span>
        <button onclick="closeModal()">‚úï</button>
      </div>
      <div id="modal-content"></div>
    </div>
  </div>

  <!-- Town Wallet Modal -->
  <div id="town-wallet-modal" class="modal-overlay hidden">
    <div class="modal-box" style="max-width:480px;width:96%;">
      <div class="modal-header">
        <span>üëõ Wallet</span>
        <button onclick="closeTownWallet()">‚úï</button>
      </div>
      <div id="town-wallet-content">
        <!-- BTCT Section -->
        <div class="tw-section">
          <div class="tw-coin-header">
            <span class="tw-coin-name">‚ö° BTCT</span>
            <span class="tw-balance" id="tw-btct-bal">Loading‚Ä¶</span>
          </div>
          <div class="tw-addr" id="tw-btct-addr">--</div>
          <div class="tw-send" id="tw-btct-send-box">
            <div class="tw-send-title">Send BTCT</div>
            <input type="text" id="tw-btct-to" placeholder="Recipient 0x..." autocomplete="off">
            <input type="number" id="tw-btct-amount" placeholder="Amount (BTCT)" step="0.00001" min="0">
            <div class="tw-fee">Network fee: 0.00001 BTCT</div>
            <div id="tw-btct-msg" class="tw-msg hidden"></div>
            <button class="btn btn-primary tw-send-btn" onclick="townWalletSendBtct()">Send BTCT</button>
          </div>
          <div id="tw-btct-nokey" class="tw-nokey hidden">
            <div style="margin-bottom:6px;">‚ö† Private key not found. Unlock to send.</div>
            <input type="password" id="tw-btct-key-input" placeholder="64-char hex private key" autocomplete="off" style="width:100%;padding:6px 8px;background:#0d1b2a;border:1px solid #2a3f5f;border-radius:4px;color:#e8eaf0;font-size:12px;box-sizing:border-box;">
            <div id="tw-btct-unlock-msg" class="tw-msg hidden" style="margin-top:4px;"></div>
            <button class="btn btn-primary tw-send-btn" style="margin-top:6px;" onclick="townUnlockBtct()">Unlock BTCT Wallet</button>
          </div>
        </div>

        <div class="tw-divider"></div>

        <!-- DOGE Section -->
        <div class="tw-section">
          <div class="tw-coin-header">
            <span class="tw-coin-name">üêï DOGE</span>
            <span class="tw-balance" id="tw-doge-bal">Loading‚Ä¶</span>
          </div>
          <div class="tw-addr" id="tw-doge-addr">--</div>
          <div class="tw-send" id="tw-doge-send-box">
            <div class="tw-send-title">Send DOGE</div>
            <input type="text" id="tw-doge-to" placeholder="Recipient D..." autocomplete="off">
            <input type="number" id="tw-doge-amount" placeholder="Amount (DOGE)" step="0.01" min="0">
            <div class="tw-fee">Network fee: ~0.02 DOGE</div>
            <div id="tw-doge-msg" class="tw-msg hidden"></div>
            <button class="btn btn-primary tw-send-btn" onclick="townWalletSendDoge()">Send DOGE</button>
          </div>
          <!-- dogeAddr ÏûàÍ≥† WIF ÏóÜÏùÑ Îïå -->
          <div id="tw-doge-nokey" class="tw-nokey hidden">
            <div style="margin-bottom:6px;">‚ö† DOGE private key not found. Enter WIF to unlock.</div>
            <input type="password" id="tw-doge-wif-input" placeholder="DOGE WIF private key (Q...)" autocomplete="off" style="width:100%;padding:6px 8px;background:#0d1b2a;border:1px solid #2a3f5f;border-radius:4px;color:#e8eaf0;font-size:12px;box-sizing:border-box;">
            <div id="tw-doge-unlock-msg" class="tw-msg hidden" style="margin-top:4px;"></div>
            <button class="btn btn-primary tw-send-btn" style="margin-top:6px;" onclick="townUnlockDoge(false)">Unlock DOGE Wallet</button>
          </div>
          <!-- dogeAddr ÏóÜÏùÑ Îïå -->
          <div id="tw-doge-none" class="tw-nokey hidden">
            <div style="margin-bottom:6px;">‚ö† No DOGE wallet. Enter WIF to add.</div>
            <input type="password" id="tw-doge-wif-new-input" placeholder="DOGE WIF private key (Q...)" autocomplete="off" style="width:100%;padding:6px 8px;background:#0d1b2a;border:1px solid #2a3f5f;border-radius:4px;color:#e8eaf0;font-size:12px;box-sizing:border-box;">
            <div id="tw-doge-none-msg" class="tw-msg hidden" style="margin-top:4px;"></div>
            <button class="btn btn-primary tw-send-btn" style="margin-top:6px;" onclick="townUnlockDoge(true)">Add DOGE Wallet</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Town Disclaimer Modal -->
  <div class="disclaimer-modal" id="townDisclaimerModal">
    <div class="disclaimer-modal-content">
      <h2>‚ö†Ô∏è BTCT Town ‚Äî Important Notice</h2>
      <div class="disclaimer-text">
        <p><strong>BTCT Town is a visual interface for the BTCT/DOGE DEX.</strong></p>
        <ul>
          <li>BTCT Town is a UI layer only. All trades are executed via HTLC atomic swaps on their respective blockchains.</li>
          <li>The server acts as a bulletin board and message relay. It never holds, accesses, or stores private keys.</li>
          <li>All transaction signing happens in your browser. Your private keys never leave your device.</li>
          <li>Chat messages between trade participants are stored on the server for dispute reference and automatically deleted after 90 days.</li>
          <li>The only data collected is: BTCT addresses (public keys) and chat messages. No personal information is collected.</li>
          <li>Platform operators are not parties to any trade and bear no responsibility for trade outcomes.</li>
          <li>Users are solely responsible for complying with applicable laws in their jurisdiction.</li>
        </ul>
        <p class="warning-text">‚ö† If a swap fails due to timeout, both BTCT and DOGE locked in HTLC contracts are refundable after their timeout periods. Ensure you understand how HTLC atomic swaps work.</p>
        <p style="font-size:12px;margin-top:12px;"><a href="/privacy" target="_blank" style="color:#4ecca3;">Privacy Policy</a></p>
      </div>
      <label class="disclaimer-checkbox">
        <input type="checkbox" id="townDisclaimerCheck" onchange="toggleTownDisclaimer()">
        <span>I have read and understood the above. I use BTCT Town at my own risk.</span>
      </label>
      <button class="btn btn-primary disclaimer-enter-btn" id="townDisclaimerEnterBtn" disabled onclick="acceptTownDisclaimer()">Enter BTCT Town</button>
    </div>
  </div>

  <!-- Market Price Panel (top-right overlay) -->
  <div id="market-panel">
    <div class="market-panel-header" onclick="toggleMarketPanel()">
      <span>‚ö° Market</span>
      <span id="market-panel-toggle-icon">‚àí</span>
    </div>
    <div class="market-panel-body" id="market-panel-body">
      <div class="mp-section">
        <div class="mp-coin">üêï DOGE / USDT</div>
        <div class="mp-price" id="mp-doge-price">--</div>
        <div class="mp-change" id="mp-doge-change">--</div>
      </div>
      <div class="mp-divider"></div>
      <div class="mp-section">
        <div class="mp-coin">‚ö° BTCT / DOGE</div>
        <div class="mp-price" id="mp-btct-price">--</div>
        <div class="mp-usd" id="mp-btct-usd">‚âà $--</div>
        <div class="mp-change" id="mp-btct-change">--</div>
        <div class="mp-row"><span class="mp-label">24h High</span><span id="mp-btct-high">--</span></div>
        <div class="mp-row"><span class="mp-label">24h Low</span><span id="mp-btct-low">--</span></div>
      </div>
      <div class="mp-footer">30s auto-refresh</div>
    </div>
  </div>

  <!-- Town Global Chat -->
  <div id="town-chat">
    <div id="town-chat-messages"></div>
    <div id="town-chat-input-row">
      <input type="text" id="town-chat-input" placeholder="Press Enter to chat..." maxlength="200" autocomplete="off">
    </div>
  </div>

  <!-- Mobile Controls (hidden by default, shown on touch devices) -->
  <div id="mobile-controls">
    <div id="joystick-base">
      <div id="joystick-stick"></div>
    </div>
    <div id="mobile-action-btn">ACT</div>
  </div>

  <!-- Controls Help -->
  <div id="controls-help">
    <span>Arrow Keys / WASD to move</span>
    <span>SPACE near NPC to interact</span>
    <span>ENTER to chat</span>
    <span><a href="/privacy" target="_blank" style="color:#666;">Privacy Policy</a></span>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="krypton-offline.js"></script>
  <script src="bitcore-doge.js?v=20260220i"></script>
  <script src="doge-htlc.js?v=20260220i"></script>
  <script src="town.js?v=20260222c"></script>
</body>
</html>
